{"ts":1355688139068,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"﻿// Filename: Controllers/index.js\r\ndefine(function (require) {\r\n    $ = require('jquery'),\r\n    _ = require('underscoreM'),\r\n    Marionette = require('marionette'),\r\n    vent = require('vent'),\r\n    WtfUserColl = require('models/collections.user'),\r\n    ProfileModel = require('Models/models.profile'),\r\n    TimelineModel = require('Models/timelineCollection'); //({ url: '/api/tweets/timeline/' + this.userName }),\r\n\r\n\r\n    var Controller = {},\r\n    tweets = new TimelineModel(),\r\n    wtfCollection = new WtfUserColl();\r\n    loggedInUser = new ProfileModel(); //{ uid: this.userName });\r\n\r\n    // private main layout for app/index route\r\n    var LayoutIndex = Marionette.Layout.extend({\r\n        template: _.template(require('text!templates/layout-index.htm')),\r\n\r\n        initialize: function (options) {\r\n            if (options && options.uid) {\r\n                //this.uid = options.uid;\r\n                //Controller.loggedInUser = new ProfileModel({ uid: this.userName });\r\n                //Controller.tweets = new TimeLine();\r\n\r\n\r\n            }\r\n        },\r\n\r\n\r\n        regions: {\r\n            navbar: '.navbar',              // main nav fixed top\r\n            container: '.appcontainer',  // contains the whole app below nav\r\n            profile: '#profile-container',  // can display another profile across top\r\n            dashboard: '.dashboard',   // user mini-profile/wtf/trending/ copyright etc\r\n            contentmain: '.content-main'  // tweets go here...\r\n        },\r\n\r\n        onRender: function () {\r\n            //this.nav.show(navView);\r\n        }\r\n    })\r\n\r\n\r\n    // private nested layout  \r\n    var LayoutDashboard = Marionette.Layout.extend({\r\n        // note {model: xxx} is passed in\r\n        tag: 'section',\r\n        template: _.template(require('text!templates/layout-dashboard.htm')),\r\n        regions: {\r\n            profileMini: '.profile-mini',\r\n            wtf: '.profile-wtf',\r\n            trends: '.profile-trend'\r\n        },\r\n        initialize: function (options) {\r\n            this.model = options.model;\r\n            this.collection = options.collection;\r\n\r\n        },\r\n        ui: {\r\n\r\n        },\r\n        events: {\r\n\r\n        },\r\n\r\n        onRender: function () {\r\n            //console.log('dashboard onRender');\r\n            var V1 = require('views/wtfComposite');\r\n            this.profileMini.show(new LayoutMiniProfile({ model: this.model }));\r\n            /*\r\n            if (console) {\r\n                console.log('dashboard-after profileMini.show');\r\n            } */\r\n            this.wtf.show(new V1({ title: 'Who to follow?', collection: this.collection }));\r\n            //console.log('dashboard-after wtf.show');\r\n            //this.trends.show(new Layoutwtf());\r\n        }\r\n\r\n    });\r\n\r\n\r\n    // private nested layout  indide \r\n    var LayoutMiniProfile = Marionette.Layout.extend({\r\n        // note {model: xxx} is passed in\r\n        tag: 'section',\r\n        className: 'module mini-profile',\r\n        template: _.template(require('text!templates/layout-mini-profile.htm')),\r\n        regions: {\r\n            profileSummary: '.profile-summary',\r\n            profileStats: '.profile-stats',\r\n            tweetBox: '.tweet-box'\r\n        },\r\n\r\n        initialize: function () { },\r\n\r\n        ui: {},\r\n\r\n        events: {},\r\n\r\n        onRender: function () {\r\n            var V1 = require('views/mini-profile-summary'),\r\n            V2 = require('views/mini-profile-stats'),\r\n            V3 = require('views/mini-tweet-box')\r\n            this.profileSummary.show(new V1({ model: this.model }));\r\n            this.profileStats.show(new V2({ model: this.model }));\r\n            this.tweetBox.show(new V3({ uid: this.model.get('uid') }));\r\n            //console.log('layoutMiniProfile:onRender');\r\n        }\r\n    });\r\n\r\n\r\n    var _initializeLayout = function () {\r\n        /*\r\n        if (console) {\r\n            console.log('initializeLayout...');\r\n        }\r\n        */\r\n        Controller.layout = new LayoutIndex();\r\n        //console.log(options);\r\n        //Controller.miniProfile = new LayoutMiniProfile();\r\n        Controller.layout.on(\"show\", function () {\r\n            vent.trigger(\"layout:rendered\");\r\n            //var NavView = require('Views/views.nav-main');\r\n\r\n        });\r\n        vent.trigger('app:show', Controller.layout);\r\n    };\r\n\r\n\r\n    Controller.index = function () {\r\n        _initializeLayout();\r\n        loggedInUser.set('uid', this.userName);\r\n        var TimelineView = require('Views/timelinecomposite');\r\n        tweets.url = '/api/tweets/timeline/' + this.userName;\r\n        wtfCollection.url = '/api/WTF/' + this.userName + '/0/5';  // page 0 size 4 ie first 4 wtf items\r\n        var NavView = require('Views/views.nav-main');\r\n        var timelineView = new TimelineView({ collection: tweets });\r\n\r\n\r\n        $.when(loggedInUser.fetch()).then(function () {\r\n            var dashLayout = new LayoutDashboard({ model: loggedInUser, collection: wtfCollection });\r\n            navView = new NavView({ model: loggedInUser });\r\n            Controller.layout.navbar.show(navView);\r\n            Controller.layout.dashboard.show(dashLayout); //this.navbar.show(navView);\r\n            Controller.layout.contentmain.show(timelineView);\r\n            tweets.fetch();\r\n            wtfCollection.fetch();\r\n        });\r\n\r\n    };\r\n\r\n    /*\r\n    Controller.home = function (id) {\r\n\r\n    if (console) {\r\n    console.log('INSIDE:  HOME route with param ' + id);\r\n    }\r\n\r\n    var profileModel = require('models.profile'),\r\n    //profileView = require('views.profile'),\r\n    //tweets = require('collections.timeline'),\r\n    // note by passing uid attrib (overridden w/ idAttrib:uid in model the fetch will append the id to the route\r\n    selUser = new profileModel({ uid: id });\r\n\r\n    //tweets.url = '/api/timeline/' + id;\r\n\r\n    $.when(selUser.fetch()).then(function () {\r\n    var pView = require('views.profile'),\r\n    pNavView = require('views.profileNav');\r\n    // dependency intection\r\n    $(new pView({ model: selUser }).render().el).appendTo($('#profile-container').empty()); // static nav view\r\n    $(new pNavView({ model: selUser }).render().el).appendTo($('.dashboard').empty()); // static nav view\r\n    $('#appModal').modal('hide');\r\n    });\r\n\r\n    };\r\n\r\n\r\n    Controller.followers = function (id) {\r\n    if (console) { console.log('INSIDE:  FOLLOWERS route with param ' + id); };\r\n\r\n    var profileModel = require('models.profile'),\r\n    selUser = new profileModel({ uid: id }),\r\n    collection = require('collections.user');\r\n\r\n\r\n    $.when(selUser.fetch()).then(function () {\r\n    var pView = require('views.profile'),\r\n    pNavView = require('views.profileNav'),\r\n    followersView = require('views.followerCollection');\r\n    // dependency intection\r\n    $(new pView({ model: selUser }).render().el).appendTo($('#profile-container').empty()); // static nav view\r\n    $(new pNavView({ model: selUser }).render().el).appendTo($('.dashboard').empty()); // static nav view\r\n    collection.url = '/api/followers/' + selUser.get('uid') + '/0/12';  // page 0 size 4 ie first 4 wtf items\r\n\r\n    $.when(collection.fetch()).then(function () {\r\n    $('#stream-items-id').empty();\r\n    new followersView({ collection: collection, el: $('#stream-items-id') }).render();\r\n    $('#appModal').modal('hide');\r\n    });\r\n    });\r\n    };\r\n\r\n\r\n    Controller.following = function (id) {\r\n    if (console) { console.log('INSIDE:  FOLLOWING route with param ' + id); };\r\n\r\n        \r\n    var profileModel = require('models.profile'),\r\n    selUser = new profileModel({ uid: id }),\r\n    followingColl = require('collections.user');\r\n\r\n\r\n    $.when(selUser.fetch()).then(function () {\r\n    var pView = require('views.profile'),\r\n    pNavView = require('views.profileNav'),\r\n    followingView = require('views.followingCollection');\r\n    // dependency intection\r\n    $(new pView({ model: selUser }).render().el).appendTo($('#profile-container').empty()); // static nav view\r\n    $(new pNavView({ model: selUser }).render().el).appendTo($('.dashboard').empty()); // static nav view\r\n    followingColl.url = '/api/following/' + selUser.get('uid') + '/0/12';  // page 0 size 4 ie first 4 wtf items\r\n\r\n    $.when(followingColl.fetch()).then(function () {\r\n    $.wait(100).then(function () {\r\n    $('#stream-items-id').empty();\r\n    new followingView({ collection: followingColl, el: $('#stream-items-id') }).render();\r\n    $('#appModal').modal('hide');\r\n    });\r\n\r\n    });\r\n    });\r\n    };\r\n\r\n    Controller.profile = function (id) {\r\n    if (console) { console.log('INSIDE:  PROFILE route with param ' + id); };\r\n    };\r\n\r\n    Controller.connect = function () {\r\n    if (console) { console.log('INSIDE:  CONNECT route with param '); };\r\n    };\r\n\r\n    Controller.discover = function () {\r\n    if (console) { console.log('INSIDE:  DISCOVER route with param '); };\r\n    };\r\n\r\n    */\r\n\r\n    var init = function (options) {\r\n        if (options && options.userName) {\r\n            Controller.userName = options.userName;\r\n            //alert(Controller.userName);\r\n        }\r\n        return Controller;\r\n    };\r\n\r\n    return init;\r\n\r\n});\r\n\r\n\r\n\r\n"]],"start1":0,"start2":0,"length1":0,"length2":9093}]],"length":9093}
{"contributors":[],"silentsave":false,"ts":1355688584493,"patch":[[{"diffs":[[-1,"﻿"],[0,"// F"]],"start1":0,"start2":0,"length1":5,"length2":4},{"diffs":[[0," = require('"],[-1,"M"],[1,"m"],[0,"odels/models"]],"start1":266,"start2":266,"length1":25,"length2":25},{"diffs":[[0,"equire('"],[-1,"M"],[1,"m"],[0,"odels/ti"]],"start1":325,"start2":325,"length1":17,"length2":17}]],"length":9092,"saved":false}
{"contributors":[],"silentsave":false,"ts":1355689572270,"patch":[[{"diffs":[[0,"timeline"],[-1,"c"],[1,"C"],[0,"omposite"]],"start1":4468,"start2":4468,"length1":17,"length2":17}]],"length":9092,"saved":false}
{"ts":1355689681728,"patch":[[{"diffs":[[0," = require('"],[-1,"V"],[1,"v"],[0,"iews/timelin"]],"start1":4450,"start2":4450,"length1":25,"length2":25},{"diffs":[[0,"View = require('"],[-1,"V"],[1,"v"],[0,"iews/views.nav-m"]],"start1":4674,"start2":4674,"length1":33,"length2":33}]],"length":9092,"saved":false}
